{
    "app-id": "io.ocrmypdf.ocrmypdf",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "24.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "ocrmypdf",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.rust-stable"
    ],
    "build-options": {
        "append-path": "/usr/lib/sdk/rust-stable/bin"
    },
    "finish-args": [
        "--filesystem=home"
    ],
    "modules": [
        {
            "name": "leptonica",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/DanBloomberg/leptonica.git",
                    "tag": "1.85.0",
                    "commit": "63aef18d98432b8582a1565e241f7bd2ee9cc8d9",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^([\\d.]+)$"
                    }
                }
            ]
        },
        {
            "name": "tesseract",
            "config-opts": [
                "--disable-graphics"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/tesseract-ocr/tesseract.git",
                    "tag": "5.5.1",
                    "commit": "3b7c70e34dea179549ed3e995872e2e019eb8477",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^([\\d.]+)$"
                    }
                }
            ]
        },
        {
            "name": "tessdata_fast",
            "buildsystem": "simple",
            "build-commands": [
                "rm -rf ${FLATPAK_DEST}/share/tessdata",
                "mkdir -p ${FLATPAK_DEST}/share/tessdata",
                "cp -av * ${FLATPAK_DEST}/share/tessdata/"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/tesseract-ocr/tessdata_fast",
                    "tag": "4.1.0",
                    "commit": "65727574dfcd264acbb0c3e07860e4e9e9b22185"
                }
            ]
        },
        {
            "name": "ghostscript",
            "config-opts": [
                "--disable-cups",
                "--disable-dbus",
                "--disable-gtk"
            ],
            "cleanup": [
                "/share/ghostscript/*/doc/",
                "/share/ghostscript/*/examples"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/ArtifexSoftware/ghostpdl.git",
                    "tag": "ghostpdl-10.05.1",
                    "commit": "7f64bc848f6b67ae204182e6e088eec110061490",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^(ghostpdl-[\\d.]+)$"
                    }
                }
            ]
        },
        {
            "name": "jbig2enc",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/agl/jbig2enc.git",
                    "tag": "0.30",
                    "commit": "cbca93f49921e6702f61031b6717575237636815",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^([\\d.]+)$"
                    }
                }
            ]
        },
        {
            "name": "pngquant",
            "buildsystem": "simple",
            "build-commands": [
                "cargo --offline fetch --manifest-path Cargo.toml --verbose",
                "cargo --offline build --release --verbose",
                "install -Dm 755 target/release/pngquant -t /app/bin"
            ],
            "build-options": {
                "env": {
                    "CARGO_HOME": "/run/build/pngquant/cargo"
                }
            },
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/kornelski/pngquant.git",
                    "tag": "3.0.3",
                    "commit": "53a332a58f44357b6b41842a54d74aa1e245913d",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^([\\d.]+)$"
                    }
                },
                "cargo-sources-pngquant.json"
            ]
        },
        {
            "name": "unpaper",
            "buildsystem": "meson",
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/unpaper/unpaper.git",
                    "tag": "unpaper-7.0.0",
                    "commit": "5211a623d48858eae154213a61bccbc368b19ca0",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^(unpaper-[\\d.]+)$"
                    }
                }
            ],
            "modules": [
                "python3-sphinx.json"
            ]
        },
        {
            "name": "qpdf",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/qpdf/qpdf.git",
                    "tag": "v12.2.0",
                    "commit": "856d32c610334855d30e96d25eb5f9636fb62f08",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^v([\\d.]+)$"
                    }
                }
            ]
        },
        "python3-requirements.json",
        {
            "name": "ocrmypdf",
            "buildsystem": "simple",
            "build-commands": [
                "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} --no-build-isolation ."
            ],
            "post-install": [
                "install -Dm644 misc/flatpak/io.ocrmypdf.ocrmypdf.metainfo.xml /app/share/metainfo/io.ocrmypdf.ocrmypdf.metainfo.xml",
                "install -Dm644 docs/images/logo-square.svg /app/share/icons/hicolor/scalable/apps/io.ocrmypdf.ocrmypdf.svg"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/ocrmypdf/OCRmyPDF.git",
                    "tag": "v16.10.4",
                    "commit": "194ca699a85b74c8d91b7c84e59ad2ef22448ac3",
                    "x-checker-data": {
                        "type": "git",
                        "tag-pattern": "^v([\\d.]+)$"
                    }
                }
            ]
        }
    ]
}
